<html>
<head>
  <meta charset="utf-8">
  <title>mei-friend online</title>
  <link rel="icon" href="https://www.mdw.ac.at/favicon.ico" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/default.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/icons.css') }}" />
  <link rel="stylesheet" id="orientationCSS" href="{{ url_for('static', filename='css/bottom.css') }}" />
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.64.0/codemirror.min.js" integrity="sha512-4DlmQ+aBOfYTZ3uzRKCDXdyL7y8IlopnVChhXG0pRFgyvhwONVQW3JX8e5DYoXUNr3evQpLZz7S3O1XxMH4WKA==" crossorigin="anonymous"
    referrerpolicy="no-referrer">
  </script> -->
  <!-- inject GitHub OAuth response details if available -->
    <script src="{{ url_for('static', filename='lib/jsgit.js') }}"></script>
    <script src="{{ url_for('static', filename='lib/github.js') }}" type="module"></script>
    <script>
      let isLoggedIn; 
      let root = "{{ url_for('static', filename='') }}";
    </script>
  {% if isLoggedIn %}
    <script>
      isLoggedIn = true;
      const githubToken = "{{ githubToken }}";
      const userLogin = "{{ userLogin }}";
      const userName = "{{ userName }}";
      const userEmail = "{{ userEmail }}";
    </script>
  {% endif %}
  <script src="{{ url_for('static', filename='CodeMirror/lib/codemirror.js') }}"></script>
  <link href="{{ url_for('static', filename='CodeMirror/lib/codemirror.css') }}" rel="stylesheet" />
  <script src="{{ url_for('static', filename='CodeMirror/mode/xml/xml.js') }}"></script>
  <link href="{{ url_for('static', filename='CodeMirror/theme/dracula.css') }}" rel="stylesheet" />
  <script src="{{ url_for('static', filename='CodeMirror/addon/edit/closetag.js') }}"></script>
  <script src="{{ url_for('static', filename='CodeMirror/addon/edit/closebrackets.js') }}"></script>
  <script src="{{ url_for('static', filename='CodeMirror/addon/edit/matchtags.js') }}"></script>
  <script src="{{ url_for('static', filename='CodeMirror/addon/edit/trailingspace.js') }}"></script>
  <script src="{{ url_for('static', filename='CodeMirror/addon/fold/xml-fold.js') }}"></script>
  <script src="{{ url_for('static', filename='CodeMirror/addon/fold/foldcode.js') }}"></script>
  <script src="{{ url_for('static', filename='CodeMirror/addon/fold/foldgutter.js') }}"></script>
  <script src="{{ url_for('static', filename='CodeMirror/addon/search/searchcursor.js') }}"></script>
  <script src="{{ url_for('static', filename='CodeMirror/addon/hint/show-hint.js') }}"></script>
  <script src="{{ url_for('static', filename='CodeMirror/addon/hint/xml-hint.js') }}"></script>
  <!--
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jshint/2.13.1/jshint.min.js" integrity="sha512-d54ZkbDqP0rlo/mmCO9nJ5tfpigsfTUPztnGEloitkJh5p2Bu4UsY8KMvAqUILBdTKGE7T6YMOuF0yXuNlpq/A==" crossorigin="anonymous" referrerpolicy="no-referrer">
  </script>
  -->
  <script type="module" src="{{ url_for('static', filename='lib/main.js') }}"></script>
</head>

<body>
  <div class="header">
    <div class="title">mei-friend online</div>
    <div class="navbar">
      <div class="dropdown">
        <button class="dropbtn">File</button>
        <div class="dropdown-content" id="FileMenu">
          <a id="OpenMei" href="#">Open MEI</a>
          <a id="ImportMusicXml" href="#">Import MusicXML</a>
          <a id="ImportHumdrum" href="#">Import Humdrum</a>
          <a id="ImportPae" href="#">Import PAE, ABC</a>
          <hr class="dropdown-line">
          <a id="SaveMei" href="#">Save MEI</a>
          <a id="SavePdf" href="#">Save PDF</a>
          <a id="SaveMidi" href="#">Save MIDI</a>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">View</button>
        <div class="dropdown-content" id="ViewMenu">
          <a id="top" href="#">Notation top</a>
          <a id="bottom" href="#">Notation bottom</a>
          <a id="left" href="#">Notation left</a>
          <a id="right" href="#">Notation right</a>
          <hr class="dropdown-line">
          <a id="rockbar" href="#">Move status bar</a>
          <a id="DoThis" href="#">Do this</a>
          <a id="DoThat" href="#">Do that</a>
        </div>
      </div>
      <div class="dropdown">
        <button class="dropbtn">Manipulate</button>
        <div class="dropdown-content" id="Manipulate">
          <a id="cleanAccid" href="#">Clean @accid.ges</a>
          <a id="renumTest" href="#">Renumber measures (test)</a>
          <a id="renumExec" href="#">Renumber measures (exec)</a>
          <hr class="dropdown-line">
        </div>
      </div>
      <div class="dropdown">
        {% if isLoggedIn -%}
          <button class="dropbtn"><img id="GithubLogo" src="{{ url_for('static', filename='img/GitHub-Mark-32px.png') }}"/>{{userName}}</button>
          <div class="dropdown-content" id="GithubMenu"></div>
        {% else %}
          <a class="dropbtn" id="GithubLogin" href="/login"><img id="GithubLogo" src="{{ url_for('static', filename='img/GitHub-Mark-32px.png') }}"/>Login</a>
        {% endif %}
      </div>
      <div class="dropdown">
        <button class="dropbtn">Help</button>
        <div class="dropdown-content" id="HelpMenu">
          <a id="GoToHelpPage" href="/help" target="_blank">Show
            help page</a>
        </div>
      </div>
    </div>
  </div>
  <div class="dragContainer">
    <div class="dragOverlay">
      <div class="dragOverlayText">Drag your input file here.</div>
    </div>
    <div class="friendContainer">
      <div class="notation"></div>
      <div class="resizer" id="dragMe"></div>
      <div class="encoding">
        <textarea id="editor"></textarea>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="leftfoot">&copy;
      <a href="https://iwk.mdw.ac.at/signature-sound-vienna/">IWK 2021</a>
    </div>
    <div class="middlefoot">
      <div class="statusbar"></div>
      <div class="progressbar"></div>
    </div>
    <div class="rightfoot"></div>
  </div>

  <script>
    // menu bar behavior like MacOS menu bars
    let show = false;
    document.querySelector(".navbar").addEventListener("click", (ev) => {
    var menuList = document.querySelectorAll(".dropdown-content");
    menuList.forEach((e) => {
      if(show && (!ev.target.closest("#GithubMenu") || ev.target.classList.contains("closeOnClick"))) {
        e.classList.remove('show');
      } else { 
        e.classList.add('show');
      }
    })

    show = !show;
    });
  </script>
</body>

</html>
